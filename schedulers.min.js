var Scheduler=function(){var n=$("#modal_job"),t=function(t){n.find(".modal-title").html("Add Job");n.data("mode","create");var i=$(this).data("id");showModal({url:"/job/create",vm:n,callback:function(){$("#frm_job").find("#ClientId").val(i).change();$("#frm_job").find("#StartDate").val(t);$("#frm_job").find("#EndDate").val(t)}})},i=function(){function r(n,t){var t='<span class="msg-delete">'+t+"<\/span>",r=$("<ul/>").addClass("list-associate");$.each(n,function(n,t){$("<li/>").text(t).appendTo(r)});t+=$("<span/>").append(r).html();t+='<div class="bootbox-body">Are you sure to proceed to create a job?<\/div>';bootbox.confirm({title:"Confirmation",message:t,buttons:{confirm:{label:"Proceed",className:"btn-primary"},cancel:{label:"Cancel"}},callback:function(n){n&&i()}})}function i(){$("#frm_job").valid()&&$.ajax({cache:!1,type:"POST",url:"/job/"+n.data("mode"),data:$("#frm_job").serialize(),success:function(t){t.success?(n.modal("hide"),toastr.success(t.message),refreshJobList()):n.find(".modal-body").html(t)},error:function(n,t,i){toastr.error(i)}})}n.on("shown.bs.modal",function(){$(this).find("#ClientId").focus()});$(".scheduler-searchform").on("click",".btn-new-job",function(n){n.preventDefault();t(moment(new Date).format("MM/DD/YYYY"))});$("body").on("click",".btn-edit-job",function(t){t.preventDefault();n.find(".modal-title").html("Edit Job");n.data("mode","edit");showModal({data:{id:$(this).data("id")},url:"/job/edit",vm:n})});n.on("click",".btn-save",function(){var u=$("#frm_job").find("#Id").val(),n=$("#frm_job").find("#FieldWorkerId").val(),f=$("#frm_job").find("#StartDate").val()+" "+$("#frm_job").find("#StartTime").val(),e=$("#frm_job").find("#EndDate").val()+" "+$("#frm_job").find("#EndTime").val(),t=$("#frm_job").find("#CrewId").val(),o={id:u,fieldWorkerId:n,crewId:t,start:f,end:e};t>0||n>0?$.ajax({url:"/job/checkworkeravailability",data:o,success:function(u){u.success&&t>0?u.available>0?toastr.error("This team is not available in this time slot"):u.members.length>0?r(u.members,"The following field worker(s) are not available in the selected time slot:"):i():u.success&&n>0&&(u.available>0?toastr.error("This field worker is not available in this time slot"):u.members.length>0?r(u.members,"This field worker is associated with following team in the selected time slot:"):i())}}):i()})},r=function(){function r(i){$("#calendar").fullCalendar({dayClick:function(n){t(moment(n.format()).format("MM/DD/YYYY"))},header:n,defaultView:"month",slotMinutes:15,editable:!0,lazyFetching:!0,droppable:!1,drop:function(n,t){var r=$(this).data("eventObject"),i=$.extend({},r);i.start=n;i.allDay=t;i.className=$(this).attr("data-class");$("#calendar").fullCalendar("renderEvent",i,!0)},events:{type:"POST",url:"/scheduler/calendar/",data:{search:i.query,jobTypeId:i.jobTypeId,fieldWorkerId:i.fieldWorkerId,assignedJobId:i.assignedJobId},error:function(){toastr.error("There was an error while fetching events!")}},loading:function(n){var t=$(".calendar");n?App.blockUI({target:t,animate:!0,overlayColor:"none"}):App.unblockUI(t)},timeFormat:"HH:mm",eventRender:function(n,t){t.popover({title:n.title,placement:"auto",content:n.content+' <a class="btn-edit-job" href="javascript:;" data-id="'+n.id+'"><i class="fa fa-pencil"><\/i><\/a>',trigger:"click",html:!0,container:"body"})}})}var n,i;jQuery().fullCalendar&&(n={},$("#calendar").parents(".portlet").width()<=720?($("#calendar").addClass("mobile"),n={left:"title, prev, next",center:"",right:"today,month,agendaWeek,agendaDay"}):($("#calendar").removeClass("mobile"),n={left:"title",center:"",right:"prev,next,today,month,agendaWeek,agendaDay"}),$("#calendar").fullCalendar("destroy"),i={query:"",jobTypeId:"",fieldWorkerId:"",assignedJobId:""},r(i),$("#btn_search").click(function(n){n.preventDefault();$("#calendar").fullCalendar("destroy");var t=$("#Query").val(),i=$("#TypeId").val(),u=$("#FieldWorkerId").val(),f=$("#AssignedJobId").val(),e={query:t,jobTypeId:i,fieldWorkerId:u,assignedJobId:f};r(e)}),$("#btn_reset").click(function(){$("#calendar").fullCalendar("destroy");r(i)}))},u=function(){var t=$("#modal_jtype");t.on("shown.bs.modal",function(){$(this).find("#Title").focus()});n.on("click","#box_jtype .btn-add",function(n){n.preventDefault();t.find(".modal-title").html("Add Job Type");t.data("mode","create");showModal({url:"/jobtype/create",vm:t})});t.on("click",".btn-save",function(){$("#frm_jtype").valid()&&$.ajax({cache:!1,type:"POST",url:"/jobtype/"+t.data("mode"),data:$("#frm_jtype").serialize(),success:function(n){n.success?(t.modal("hide"),toastr.success(n.message),fillDropdownList({target:$("#frm_job").find("#TypeId"),url:"/jobtype/listfordropdown",callback:function(){$("#frm_job").find("#TypeId").val(n.id)}})):t.find(".modal-body").html(n)},error:function(n,t,i){toastr.error(i)}})})},f=function(){var t=$("#modal_jstatus");t.on("shown.bs.modal",function(){$(this).find("#Title").focus()});n.on("click","#box_jstatus .btn-add",function(n){n.preventDefault();t.find(".modal-title").html("Add Job Status");t.data("mode","create");showModal({url:"/jobstatus/create",vm:t})});t.on("click",".btn-save",function(){$("#frm_jstatus").valid()&&$.ajax({cache:!1,type:"POST",url:"/jobstatus/"+t.data("mode"),data:new FormData($("#frm_jstatus")[0]),contentType:!1,processData:!1,success:function(n){n.success?(t.modal("hide"),toastr.success(n.message),fillDropdownList({target:$("#frm_job").find("#StatusId"),url:"/jobstatus/listfordropdown",callback:function(){$("#frm_job").find("#StatusId").val(n.id)}})):t.find(".modal-body").html(n)},error:function(n,t,i){toastr.error(i)}})})};return{init:function(){i();r();u();f()}}}();jQuery(document).ready(function(){Scheduler.init()});
//# sourceMappingURL=schedulers.min.js.map
