var JobEdit_01=function(){var n=$("#modal_job"),t=function(){function i(n,i){var i='<span class="msg-delete">'+i+"<\/span>",r=$("<ul/>").addClass("list-associate");$.each(n,function(n,t){$("<li/>").text(t).appendTo(r)});i+=$("<span/>").append(r).html();i+='<div class="bootbox-body">Are you sure to proceed to create a job?<\/div>';bootbox.confirm({title:"Confirmation",message:i,buttons:{confirm:{label:"Proceed",className:"btn-primary"},cancel:{label:"Cancel"}},callback:function(n){n&&t()}})}function t(){$("#frm_job").valid()&&$.ajax({cache:!1,type:"POST",url:"/job/"+n.data("mode"),data:$("#frm_job").serialize(),success:function(t){t.success?(n.modal("hide"),toastr.success(t.message),r()):n.find(".modal-body").html(t)},error:function(n,t,i){toastr.error(i)}})}function r(){$("#frm_job_search").find("#btn_search").click()}n.on("shown.bs.modal",function(){$(this).find("#ClientId").focus()});$("#btn_new").on("click",function(t){t.preventDefault();n.find(".modal-title").html("Add Job");n.data("mode","create");showModal({url:"/job/create",vm:n})});$("#datatable_ajax tbody").on("click",".btn-edit",function(t){t.preventDefault();n.find(".modal-title").html("Edit Job");n.data("mode","edit");showModal({data:{id:$(this).data("id")},url:"/job/edit",vm:n})});$("#datatable_ajax tbody").on("click",".btn-view-job",function(t){t.preventDefault();n.find(".modal-title").html("View Job");n.data("mode","view");showModal({data:{id:$(this).data("id")},url:"/job/viewjob",vm:n})});n.on("click",".btn-save",function(){var u=$("#frm_job").find("#Id").val(),n=$("#frm_job").find("#FieldWorkerId").val(),f=$("#frm_job").find("#StartDate").val()+" "+$("#frm_job").find("#StartTime").val(),e=$("#frm_job").find("#EndDate").val()+" "+$("#frm_job").find("#EndTime").val(),r=$("#frm_job").find("#CrewId").val(),o={id:u,fieldWorkerId:n,crewId:r,start:f,end:e};r>0||n>0?$.ajax({url:"/job/checkworkeravailability",data:o,success:function(u){u.success&&r>0?u.available>0?toastr.error("This team is not available in this time slot"):u.members.length>0?i(u.members,"The following field worker(s) are not available in the selected time slot:"):t():u.success&&n>0&&(u.available>0?toastr.error("This field worker is not available in this time slot"):u.members.length>0?i(u.members,"This field worker is associated with following team in the selected time slot:"):t())}}):t()})},i=function(){var t=$("#modal_jtype");t.on("shown.bs.modal",function(){$(this).find("#Title").focus()});n.on("click","#box_jtype .btn-add",function(n){n.preventDefault();t.find(".modal-title").html("Add Job Type");t.data("mode","create");showModal({url:"/jobtype/create",vm:t})});t.on("click",".btn-save",function(){$("#frm_jtype").valid()&&$.ajax({cache:!1,type:"POST",url:"/jobtype/"+t.data("mode"),data:$("#frm_jtype").serialize(),success:function(n){n.success?(t.modal("hide"),toastr.success(n.message),fillDropdownList({target:$("#frm_job").find("#TypeId"),url:"/jobtype/listfordropdown",callback:function(){$("#frm_job").find("#TypeId").val(n.id)}})):t.find(".modal-body").html(n)},error:function(n,t,i){toastr.error(i)}})})},r=function(){var t=$("#modal_jstatus");t.on("shown.bs.modal",function(){$(this).find("#Title").focus()});n.on("click","#box_jstatus .btn-add",function(n){n.preventDefault();t.find(".modal-title").html("Add Job Status");t.data("mode","create");showModal({url:"/jobstatus/create",vm:t})});t.on("click",".btn-save",function(){$("#frm_jstatus").valid()&&$.ajax({cache:!1,type:"POST",url:"/jobstatus/"+t.data("mode"),data:new FormData($("#frm_jstatus")[0]),contentType:!1,processData:!1,success:function(n){n.success?(t.modal("hide"),toastr.success(n.message),fillDropdownList({target:$("#frm_job").find("#StatusId"),url:"/jobstatus/listfordropdown",callback:function(){$("#frm_job").find("#StatusId").val(n.id)}})):t.find(".modal-body").html(n)},error:function(n,t,i){toastr.error(i)}})})};return{init:function(){t();i();r()}}}();jQuery(document).ready(function(){JobEdit_01.init()});