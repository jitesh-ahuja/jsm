var Clients=function(){var n=$("#modal_job"),t=$("#modal_viewclient"),u=function(){var n=new Datatable;n.init({src:$("#datatable_ajax"),onSuccess:function(){},onError:function(){},loadingMessage:"Loading...",dataTable:{bStateSave:!0,lengthMenu:[[10,20,50,100,150],[10,20,50,100,150]],pageLength:10,ajax:{url:"/client/list"},columns:[{data:"AccountNumber",orderable:!0},{data:"Name",orderable:!0,render:function(n,t,i){return t=="display"?'<a href="/client/edit/'+i.Id+'">'+n+"<\/a>":n}},{data:"Location",orderable:!0},{data:"Phone",orderable:!0},{data:"Email",orderable:!0},{data:"Id",orderable:!1,render:function(n,t,i){return t==="display"?'<a class="btn btn-xs default green-haze-stripe btn-view-client" href="javascript:;" data-id="'+i.Id+'"> View<\/a>                                           <a class="btn btn-xs default btn-edit" href="/client/edit/'+i.Id+'"><i class="fa fa-pencil"><\/i> Edit<\/a>                                         <a class="btn btn-xs red-haze btn-delete" href="javascript:;" data-id="'+i.Id+'"><i class="fa fa-trash-o"><\/i> Delete<\/a>                                         <a class="btn btn-xs default btn-new-job" href="javascript:;" data-id="'+i.Id+'"><i class="fa fa-plus"><\/i> New Job<\/a>':n}}],buttons:[{extend:"print",className:"btn dark btn-outline",exportOptions:{columns:[0,1,2,3]}},{extend:"copy",className:"btn red btn-outline",exportOptions:{columns:[0,1,2,3]}},{extend:"pdf",className:"btn green btn-outline",exportOptions:{columns:[0,1,2,3]}},{extend:"excel",className:"btn yellow btn-outline ",exportOptions:{columns:[0,1,2,3]}},{extend:"csv",className:"btn purple btn-outline ",exportOptions:{columns:[0,1,2,3]}},{extend:"colvis",className:"btn dark btn-outline",text:"Columns",exportOptions:{columns:[0,1,2,3]}}],order:[[0,"asc"]]}});$("#tools > li > a.tool-action").on("click",function(){var t=$(this).attr("data-action");n.getDataTable().button(t).trigger()});$("#btn_search").on("click",function(t){t.preventDefault();var i=$("#frm_client").serializeArray();$.each(i,function(t,i){n.setAjaxParam(i.name,i.value)});n.getDataTable().ajax.reload()});$("#btn_reset").on("click",function(){n.clearAjaxParams();n.getDataTable().ajax.reload()});$("#datatable_ajax tbody").on("click",".btn-delete",function(t){t.preventDefault();deleteEntity({data:{id:$(this).data("id")},confirm:!0,message:"Are you sure you want to delete this client?",url:"/client/delete",grid:n})})},i,r;return viewClients=function(){$("#datatable_ajax tbody").on("click",".btn-view-client",function(n){n.preventDefault();t.find(".modal-title").html("View Client");t.data("mode","create");var i=$(this).data("id");showModal({url:"/client/viewclient",data:{id:$(this).data("id")},vm:t})})},handleJobs=function(){function i(n,i){var i='<span class="msg-delete">'+i+"<\/span>",r=$("<ul/>").addClass("list-associate");$.each(n,function(n,t){$("<li/>").text(t).appendTo(r)});i+=$("<span/>").append(r).html();i+='<div class="bootbox-body">Are you sure to proceed to create a job?<\/div>';bootbox.confirm({title:"Confirmation",message:i,buttons:{confirm:{label:"Proceed",className:"btn-primary"},cancel:{label:"Cancel"}},callback:function(n){n&&t()}})}function t(){$("#frm_job").valid()&&$.ajax({cache:!1,type:"POST",url:"/job/"+n.data("mode"),data:$("#frm_job").serialize(),success:function(t){t.success?(n.modal("hide"),toastr.success(t.message),refreshJobList()):n.find(".modal-body").html(t)},error:function(n,t,i){toastr.error(i)}})}n.on("shown.bs.modal",function(){$(this).find("#ClientId").focus()});$("#datatable_ajax tbody").on("click",".btn-new-job",function(t){t.preventDefault();n.find(".modal-title").html("Add Job");n.data("mode","create");var i=$(this).data("id");showModal({url:"/job/create",vm:n,callback:function(){$("#frm_job").find("#ClientId").val(i).change()}})});n.on("click",".btn-save",function(){var u=$("#frm_job").find("#Id").val(),n=$("#frm_job").find("#FieldWorkerId").val(),f=$("#frm_job").find("#StartDate").val()+" "+$("#frm_job").find("#StartTime").val(),e=$("#frm_job").find("#EndDate").val()+" "+$("#frm_job").find("#EndTime").val(),r=$("#frm_job").find("#CrewId").val(),o={id:u,fieldWorkerId:n,crewId:r,start:f,end:e};r>0||n>0?$.ajax({url:"/job/checkworkeravailability",data:o,success:function(u){u.success&&r>0?u.available>0?toastr.error("This team is not available in this time slot"):u.members.length>0?i(u.members,"The following field worker(s) are not available in the selected time slot:"):t():u.success&&n>0&&(u.available>0?toastr.error("This field worker is not available in this time slot"):u.members.length>0?i(u.members,"This field worker is associated with following team in the selected time slot:"):t())}}):t()})},i=function(){var t=$("#modal_jtype");t.on("shown.bs.modal",function(){$(this).find("#Title").focus()});n.on("click","#box_jtype .btn-add",function(n){n.preventDefault();t.find(".modal-title").html("Add Job Type");t.data("mode","create");showModal({url:"/jobtype/create",vm:t})});t.on("click",".btn-save",function(){$("#frm_jtype").valid()&&$.ajax({cache:!1,type:"POST",url:"/jobtype/"+t.data("mode"),data:$("#frm_jtype").serialize(),success:function(n){n.success?(t.modal("hide"),toastr.success(n.message),fillDropdownList({target:$("#frm_job").find("#TypeId"),url:"/jobtype/listfordropdown",callback:function(){$("#frm_job").find("#TypeId").val(n.id)}})):t.find(".modal-body").html(n)},error:function(n,t,i){toastr.error(i)}})})},r=function(){var t=$("#modal_jstatus");t.on("shown.bs.modal",function(){$(this).find("#Title").focus()});n.on("click","#box_jstatus .btn-add",function(n){n.preventDefault();t.find(".modal-title").html("Add Job Status");t.data("mode","create");showModal({url:"/jobstatus/create",vm:t})});t.on("click",".btn-save",function(){$("#frm_jstatus").valid()&&$.ajax({cache:!1,type:"POST",url:"/jobstatus/"+t.data("mode"),data:new FormData($("#frm_jstatus")[0]),contentType:!1,processData:!1,success:function(n){n.success?(t.modal("hide"),toastr.success(n.message),fillDropdownList({target:$("#frm_job").find("#StatusId"),url:"/jobstatus/listfordropdown",callback:function(){$("#frm_job").find("#StatusId").val(n.id)}})):t.find(".modal-body").html(n)},error:function(n,t,i){toastr.error(i)}})})},{init:function(){u();handleJobs();i();r();viewClients()}}}();jQuery(document).ready(function(){Clients.init()});